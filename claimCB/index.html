<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind CSS Imports -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>

  <!-- Alpine.js -->
  <script type="module" src="/src/index.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- JavaScript Stellar SDK -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/10.4.0/stellar-sdk.js"></script>
</head>

<body>
  <div class="container mx-auto">
    <h2 class="text-2xl font-bold">Claim Claimable Balance</h2>
    <div x-data="$store.claimClaimableBalanceStore" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
      <form @submit.prevent>
        <label for="claimantPubkey">Claimant Public Key</label><br />
        <input type="text" name="claimantPubkey" id="claimantPubkey" x-model="claimant" /><br />

        <template x-if="!fetchedCBs">
          <button
            class="bg-indigo-500 text-white active:bg-indigo-600 text-xs font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1"
            @click="fetchClaimableBalances">
            Fetch Available CBs
          </button>
        </template>

        <div x-show="fetchedCBs">

          <div x-show="cbArray.length !== 0">
            <template x-for="record in cbArray" :key="record.id">
              <label>
                <input type="checkbox" :value="record.id" x-model="selectedCBs">
                <span
                  x-text="`${parseFloat(record.amount)} ${record.asset === 'native' ? 'XLM' : record.asset}`"></span></span>
              </label><br />
            </template><br />

            <label for="claimantSecret">Claimant Secret Key</label><br />
            <input type="password" name="claimantSecret" id="claimantSecret" x-model="secret" /><br />
            <button
              class="bg-indigo-500 text-white active:bg-indigo-600 text-xs font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1"
              type="submit" @click="claimSelectedBalances()">
              Claim Selected Balances
            </button><br />
          </div>

          <div x-show="cbArray.length === 0">
            No claimable balances found<br />
          </div>

          <button
            class="bg-red-500 text-white active:bg-red-600 text-xs font-bold uppercase px-3 py-1 rounded outline-none focus:outline-none mr-1 mb-1"
            @click="resetState">
            Reset
          </button>
        </div>
      </form>

      <p>Transaction Hash: <span x-text="txHash"></span></p>
    </div>
  </div>
</body>

</html>